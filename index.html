<script>
  (function () {
    const params = new URLSearchParams(window.location.search);
    const code = params.get('code');
    const listId = params.get('listId');
    const boardId = params.get('boardId');

    let schemeLink = null;

    if (code) {
      schemeLink = 'hasnat://invite?code=' + encodeURIComponent(code);
    } else if (boardId) {
      schemeLink = 'hasnat://?boardId=' + encodeURIComponent(boardId) + '&type=board';
    } else if (listId) {
      schemeLink = 'hasnat://?listId=' + encodeURIComponent(listId) + '&type=list';
    } else {
      document.getElementById('desc').innerText = 'Invalid invite link.';
      return;
    }

    document.getElementById('openAppBtn').href = schemeLink;

    // Use hidden anchor click instead of window.location.href â€” works in Safari/Gmail web view
    const a = document.createElement('a');
    a.href = schemeLink;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);

    setTimeout(function () {
      document.getElementById('fallback').style.display = 'block';
      document.getElementById('desc').innerText = 'Tap the button to open the app, or install it from the store.';
    }, 800);
  })();
</script>
